<html>
<head>
<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="js/jquery.ws-0.3-noenc-pre.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    var inputchk= function(){
      if($("#txt").val()===""){$("#txt").focus();return false}
      else if($("#txt").val()===""){$("#txt").focus();return false}
      else {return true}
    }
    var colour= "rgb(" +  Math.floor((Math.random()*255))+"," + Math.floor((Math.random()*255)) + "," + Math.floor((Math.random()*255)) +")";
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    ctx.fillStyle = colour;
    ctx.fillRect (0, 0, 500, 10);
    
    var ws = $.ws.conn({
      url : 'ws://localhost:8080',
      hbStr: null,
      renderbox: function(boxString) {
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = boxString[5];
        ctx.fillRect (boxString[1], boxString[2], boxString[3], boxString[4]);
      },
      onopen : function () {
        console.log('connected');
        var self= this;
        setInterval(function(){
                      
           var x= Math.random()*480, 
               y= Math.random()*480,
               width= 55,
               height= 55;
           var box= ['box', x,y,width,height, colour]; 
           //self.renderbox( box );
           $(ws).wssend(JSON.stringify([1,box]));
        }, 1000)
      },

      onmessage : function (event) {          
        try {
          var packets=eval(event);
          for(var i=0;i< packets[1].length;i++)  {
            console.log(JSON.stringify(packets[1][i]))
//            this.renderbox([packets[1][2],packets[1][3],packets[1][4],packets[1][5]]);
              this.renderbox(packets[1][i]);
          } 
        }
        catch(e) {
                                             console.log(e +" : " + event);
        }
      },

      onclose : function (event) {
        console.log('disconnected');
      }
    });
  });
</script>
</head>
<body>
  <canvas id="canvas" width="500" height="500"></canvas>
</body>
</html>